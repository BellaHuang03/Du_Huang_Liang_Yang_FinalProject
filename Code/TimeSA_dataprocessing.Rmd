1.  Session Set up :
```{r, message = FALSE}
library(tidyverse)
library(lubridate)  
library(zoo)
library(trend)
library(here)
library(ggplot2)
library(Kendall)
library(dplyr)
library(readr)
library(purrr)
getwd()

mytheme <- theme_classic(base_size = 14) +
  theme(axis.text = element_text(color = "black"),
        panel.background = element_rect(fill ="white", color = NA),
        plot.background = element_rect(fill = "white", color = NA),
        plot.title = element_text(
          hjust = 0.5,         
          face = "bold"),
        legend.position = "middle")


```
2. Import the ten datasets from the time_series folder in the egrid_Data data folder. 
```{r, echo=FALSE}
library(readr)
ts2018 <- read_csv("Data/Raw/egrid_Data/time_series/ts2018.csv")
ts2019 <- read_csv("Data/Raw/egrid_Data/time_series/ts2019.csv")
ts2020 <- read_csv("Data/Raw/egrid_Data/time_series/ts2020.csv")
ts2021 <- read_csv("Data/Raw/egrid_Data/time_series/ts2021.csv")
ts2022 <- read_csv("Data/Raw/egrid_Data/time_series/ts2022.csv")
ts2023 <- read_csv("Data/Raw/egrid_Data/time_series/ts2023.csv")

```

```{r, echo=FALSE}
library(dplyr)

all_ts <- bind_rows(
  ts2018,
  ts2019,
  ts2020,
  ts2021,
  ts2022,
  ts2023,
  .id = "source_file"
)

# fill all missing value with NA
all_ts <- all_ts %>%
  mutate(across(everything(), ~ na_if(.x, "")))

# preview
dim(all_ts)
names(all_ts)
glimpse(all_ts)
```

3. Set date column as a date class.

```{r, message = FALSE}
# keep only rows where Data Year is exactly 4 digits
valid_year_rows <- grepl("^\\d{4}$", as.character(all_ts$`Data Year`))
all_ts <- all_ts[valid_year_rows, ]

#data exploration
unique(all_ts$`Plant primary coal/oil/gas/ other fossil fuel category`)
table(all_ts$`Plant primary coal/oil/gas/ other fossil fuel category`)
all_ts$`Plant primary fuel category`

top6_species <- head(sort(table(all_ts$`Plant primary coal/oil/gas/ other fossil fuel category`), decreasing = TRUE), 6)
head(top6_species)

```

4. check if there's missing data
```{r, message = FALSE}
colSums(is.na(all_ts))

all_ts$FuelUnified <- dplyr::coalesce(
  all_ts$`Plant primary fuel category`,
  all_ts$`Plant primary coal/oil/gas/ other fossil fuel category`
)

```

```{r, message = FALSE}
all_ts <- all_ts %>%
  filter(
    `Plant nameplate capacity (MW)` != "NAMEPCAP",
    `Plant annual net generation (MWh)` != "PLNGENAN",
    `Plant name` != "PNAME",
    `Data Year` != "YEAR"
  ) %>%
  select(
    -source_file,
    -`Plant primary fuel category`
  )

all_ts <- all_ts %>%
  mutate(
    cap_mw = parse_number(`Plant nameplate capacity (MW)`),
    gen_mwh = parse_number(`Plant annual net generation (MWh)`)
  )

all_ts <- all_ts %>%
  mutate(
    Data_Year_char = as.character(`Data Year`),
    Data_Year_num  = as.integer(Data_Year_char)
  )

table(all_ts$Data_Year_num, useNA = "ifany")


annual_totals <- all_ts %>%
  filter(FuelUnified %in% c("WIND", "SOLAR")) %>%
  group_by(Data_Year_num, FuelUnified) %>%
  summarise(
    total_capacity_MW = sum(cap_mw, na.rm = TRUE),
    n_plants = n(),
    .groups = "drop"
  )



```


5. Plot the trend for generating capacity over 2018-2023 for wind and solar
```{plot the trend for wind and solar, message = FALSE}

ggplot(annual_totals, aes(x = Data_Year_num, y = total_capacity_MW, color = FuelUnified)) +
  geom_line(linewidth = 1.3) +
  geom_point(size = 3) +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed") +
  labs(
    title = "Wind vs Solar Capacity Additions (2018â€“2023)",
    x = "Year",
    y = "Total Nameplate Capacity (MW)",
    color = "Technology"
  ) +
  theme_minimal(base_size = 14)

```
>Is wind  increasing or decreasing?
Is solar accelerating faster?
Which is more volatile?

```{statistical trend analysis for wind and solar, message = FALSE}
wind_trend <- lm(total_capacity_MW ~ Data_Year_num,
                 data = annual_totals %>% filter(FuelUnified == "WIND"))

solar_trend <- lm(total_capacity_MW ~ Data_Year_num,
                  data = annual_totals %>% filter(FuelUnified == "SOLAR"))

summary(wind_trend)
summary(solar_trend)


```
6. Plot the trend for total generation
```{r, message = FALSE}

```

7.
```{r}

```

